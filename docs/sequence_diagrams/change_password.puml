@startuml change_password

' Component definitions
participant "Business User" as User
participant "ChangePasswordUI\n(boundary/user_ui.py\nchange_password_get/post)" as ChangePasswordUI
participant "UserController\n(Controller/user_controller.py)" as UserController
participant "RegisteredUser\n(entity)" as BusinessUser

' GET request flow
User -> ChangePasswordUI: Navigate to change password
activate ChangePasswordUI

ChangePasswordUI -> UserController: get_user(user_type, user_id)
activate UserController
UserController --> ChangePasswordUI: return RegisteredUser
deactivate UserController

ChangePasswordUI --> User: Display change_password.html
deactivate ChangePasswordUI

' POST request flow
User -> ChangePasswordUI: Submit current and new password
activate ChangePasswordUI

ChangePasswordUI -> UserController: dict[str, Any] change_password(user, current_password, new_password)
activate UserController

UserController -> UserController: Verify current password\nagainst password_hash
activate UserController
deactivate UserController

alt current password is correct
    UserController -> BusinessUser: Hash new password\nand update password_hash
    activate BusinessUser
    BusinessUser --> UserController: Password updated
    deactivate BusinessUser
    
    UserController --> ChangePasswordUI: return dict[str, Any]\n(status='success')
    
    ChangePasswordUI --> User: Redirect to profile\nwith message:\n"Password changed successfully."
else current password is incorrect
    UserController --> ChangePasswordUI: return dict[str, Any]\n(status='failure',\nmessage='Current password is incorrect.')
    
    ChangePasswordUI --> User: Display change_password.html\nwith error message
end

deactivate UserController
deactivate ChangePasswordUI

@enduml
